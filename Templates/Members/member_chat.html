<!DOCTYPE html>
<html lang="en">
    {% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Chat</title>
    <link rel="stylesheet" href="{% static 'css/chat.css' %}">
</head>
<style>
    #chatContainer {
        display: flex;
        height: 100vh;
        background-color: #f0f0f0;
    }
    
    #chatSidebar {
        width: 25%;
        background-color: #ffffff;
        border-right: 1px solid #ccc;
        padding: 10px;
        overflow-y: auto;
    }
    
    #chatWindow {
        width: 75%;
        display: flex;
        flex-direction: column;
        background-color: #e5ddd5;
        position: relative;
    }
    
    #messages {
        flex: 1;
        padding: 10px;
        overflow-y: scroll;
    }
    
    #chatInput {
        padding: 10px;
        width: calc(100% - 80px);
        border: none;
        border-top: 1px solid #ccc;
        font-size: 16px;
    }
    
    #sendMessage {
        width: 80px;
        border: none;
        background-color: #075e54;
        color: white;
        cursor: pointer;
    }    
</style>
<body>
    <div id="chatContainer">
        <div id="chatWindow">
            <div id="messages">
                <!-- Messages will be displayed here dynamically -->
            </div>
            <textarea id="chatInput" placeholder="Type a message..."></textarea>
            <button id="sendMessage">Send</button>
        </div>
    </div>

    <script src="{% static 'js/chat.js' %}"></script>
    <script>
        // JavaScript code goes here
        const roomName = "{{ room_name }}";  // Make sure room_name is passed from Django view

        const chatSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/chat/' + roomName + '/'
        );

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            document.querySelector('#chat-log').value += (data.sender + ': ' + data.message + '\n');
        };

        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        document.querySelector('#chat-message-input').onkeyup = function(e) {
            if (e.keyCode === 13) {  // Enter key
                const messageInputDom = document.querySelector('#chat-message-input');
                const message = messageInputDom.value;
                chatSocket.send(JSON.stringify({
                    'message': message,
                    'room_name': roomName
                }));
                messageInputDom.value = '';
            }
        };
    </script>
</body>
</html>
